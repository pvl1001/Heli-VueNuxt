#Управлению проектом

###Необходимые программы на компьютере с операционной системой macOS
- Программа https://www.parallels.com/ru/ для виртуализации Docker окружения через Docker Machine.
- Docker Toolbox https://docs.docker.com/toolbox/toolbox_install_mac
- Git https://git-scm.com/download/mac
- Программа brew
###Необходимые программы на компьютере с операционной системой Windows
- Docker Machine https://docs.docker.com/machine/install-machine/
- VirtualBox https://www.virtualbox.org/
- Git Bash https://gitforwindows.org/
- Docker for Windows https://docs.docker.com/docker-for-windows/install/

###Первая установка проекта
В первую очередь необходимо установить проект из git репозитория.  
Для этого необходимо зайти в папку где будет размещен проект и выполнить команду.
```bash
git clone git@gitlab.com:igor-vetrov-dev-team/helihop.git helihop
cd helihop
git checkout develop
```
После выполнения этих команд, на компьютере будет создан проект в папке cotd.local и будет использоваться ветка develop.

Теперь необходимо запустить установку docker виртуализации и сконфигурировать проект, для этого выполняем следующие команды.
Для MacOS
```bash
./app.sh dm-build "parallels"
```
Для Windows
```bash
./app.sh dm-build "virtualbox" "D:\\:d"
```
###Настройка laravel
* Зайти в админер и создать бд `helihop_local` кодировка `utf8_general_ci`
* Зайти в директорию `/app` и установить зависимости composer
```
docker exec -it docker_helihop_local_php_1 composer install
```
* Выполнить настройку подключения к mysql в файле `/app/.env`
* Выполнить по очереди команды
```
docker exec -it docker_helihop_local_php_1 php artisan migrate
```
* Для доступа к разрешениям суперпользователя после регистрации и подтверждения выполнить команду и следовать инструкции
```
docker exec -it docker_cotd_local_php_1 ./yii role/assign
```
* Для генерации документации
```
docker exec -it docker_cotd_local_php_1 ./yii doc/build
```
Документация доступна по `http://helihop.local/docs/`



###Остановка Docker окружения
Если с проектом закончена работа, необходимо остановить Docker окружения, чтобы компьютер не использовал лишние ресурсы и не тормозил во время других необходимых операциях.  
Необходимо выполнить команду.
```bash
./app.sh dm-stop
```

###Повторный запуск Docker окружения
Когда выполнен пункт «Первая установка проекта», для повторного запуска проекта необходимо выполнить следующие команды, находясь в корне папки с проектом.
```bash
./app.sh dm-start
```

###Запуск демонов на локальной машине для выполнения фоновых заданий
```bash
docker exec -it docker_cotd_local_php_1 php yii queue/listen -v --color
```

###Добавление изменений в GIT репозиторий
После того как были внесены изменения в коде проекта, необходимо эти изменения передать в репозиторий GIT.  
Для этого передача изменений делается в четыре этапа:

1 ) Принять все изменения которые могли делаться во время нашей работы. Возможно другие разработчики вели работу и выкатили свои изменения в репозиторий, для избежания конфликтов кода необходимо в первую очередь принять все изменения из глобального репозитория и только после этого передать свои изменения.
```bash
git pull origin develop
```
2 ) Добавляем новые или измененные файлы в локальный GIT репозиторий чтобы в последствии их закомитить. К примеру был изменен файл /app/wp-content/themes/itsm/header.php
```bash
git add app/wp-content/themes/itsm/header.php
```
3 ) Комитим изменения с комментарием о проделанной работе
```bash
git commit -m "Скрыл кнопку Попробовать"
```
4 ) Передача коммита в глобальный репозиторий GIT в ветку develop
```bash
git push origin develop
```
После этих действий все наши изменения отображаются в репозитории BitBucket.  

###Перенос изменений на production сервер
Перед тем как переносить изменения на сервер необходимо убедиться что был выполнен пункт «Добавление изменений в GIT репозиторий».  
  
**Важно: Если после принятия изменений из пункта «Добавление изменений в GIT репозиторий», было замечено что пришли измененные файлы, необходимо убедиться в корректной работе проекта. Так как после переноса всех изменений по проекту посредством данного пункта, все изменения которые присутствуют в ветке develop перенесутся на production сервер.
Перенос изменений сделанных в административной части WordPress (установка плагинов или добавление информации) необходимо выполнять так же и на production сервере, посредством автоматического деплоя на production сервер переносится только код который был добавлен командой git add, база данных не переносится.**
  
Заходим в bitbucket или gitlab в раздел Pull-запросы.
Создаем pull-запрос на слияние develop ветки в master ветку.
Отписываемся руководителю что бы тот принял реквест.